---
// dummydauta för projekt
const projects = [
  { id: "proj_1", name: "Munamii Cakery" },
  { id: "proj_2", name: "Cars VII" },
  { id: "proj_3", name: "HollyView" },
  { id: "proj_4", name: "ProPlanner" },
  { id: "proj_5", name: "utomstående" },
];

// dummy för ansvariga personer
const assignees = [
  { id: 1, name: "Fredrik Björklund" },
  { id: 2, name: "Tomas Mauritzson" },
  { id: 3, name: "Khattab Alshami" },
  { id: 4, name: "Mats Lind" },
  { id: 5, name: "Danny Gomez" },
];
---

<style>
  /* kalender */
  input[type="date"]::-webkit-calendar-picker-indicator {
    cursor: pointer;
    opacity: 0.6;
    transition: opacity 0.2s;
  }
  input[type="date"]::-webkit-calendar-picker-indicator:hover {
    opacity: 1;
  }

  /* select */
  select[multiple] {
    background-image: none;
  }
</style>

<div
  class="bg-stone-50 p-4 sm:p-6 lg:p-8 min-h-screen flex items-center justify-center font-sans"
>
  <form
    id="task-form"
    class="w-full max-w-lg bg-white p-8 rounded-xl shadow-lg space-y-6 border border-gray-200"
  >
    <!-- Formulärrubrik -->
    <div class="text-center">
      <h2 class="text-2xl font-bold text-gray-800">Todo Task</h2>
      <p class="text-stone-500 mt-1">Fyll i taskiga detaljer.</p>
    </div>

    <!-- Fält för Titel -->
    <div>
      <label for="title" class="block text-sm font-medium text-gray-700 mb-1"
        >Titel</label
      >
      <input
        type="text"
        name="title"
        id="title"
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring focus:ring-teal-500 focus:ring-opacity-50 transition duration-150 ease-in-out"
        placeholder="commit my shit"
        required
      />
    </div>

    <!-- Fält för Projekt -->
    <div>
      <label
        for="project_id"
        class="block text-sm font-medium text-gray-700 mb-1">Projekt</label
      >
      <select
        id="project_id"
        name="project_id"
        class="mt-1 block w-full rounded-md border-gray-300 py-2 px-3 shadow-sm focus:border-teal-500 focus:outline-none focus:ring focus:ring-cyan-500 focus:ring-opacity-50 transition duration-150 ease-in-out"
      >
        <option value="" disabled selected>Välj ett projekt</option>
        {
          projects.map((project) => (
            <option value={project.id}>{project.name}</option>
          ))
        }
      </select>
    </div>

    <!-- Fält för Beskrivning -->
    <div>
      <label
        for="description"
        class="block text-sm font-medium text-gray-700 mb-1">Beskrivning</label
      >
      <textarea
        id="description"
        name="description"
        rows="4"
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring focus:ring-teal-500 focus:ring-opacity-50 transition duration-150 ease-in-out"
        placeholder="Beskriv taskigheterna i detalj"></textarea>
    </div>
<!-- <SegmentedControl.Root defaultValue="inbox">
	<SegmentedControl.Item value="inbox">Inbox</SegmentedControl.Item>
	<SegmentedControl.Item value="drafts">Drafts</SegmentedControl.Item>
	<SegmentedControl.Item value="sent">Sent</SegmentedControl.Item>
</SegmentedControl.Root> -->

    <!-- Fält för Prioritet -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-4">
        Prioritet
      </label>

      <div class="flex justify-between gap-2">
        <!-- Alternativ för "Låg" prioritet -->
        <div>
          <input
            type="radio"
            id="priority_low"
            name="priority"
            value="low"
            class="hidden peer"
          />
          <label
            for="priority_low"
            class="w-full text-center p-3 rounded-lg border-2 border-gray-200 cursor-pointer transition-all duration-200 ease-in-out peer-checked:border-green-500 peer-checked:bg-green-50 peer-checked:font-bold peer-checked:text-green-800 hover:bg-cyan-100"
          >
            Låg
          </label>
        </div>

        <!-- Alternativ för "Medel" prioritet -->
        <div>
          <input
            type="radio"
            id="priority_medium"
            name="priority"
            value="medium"
            class="hidden peer"
          />
          <label
            for="priority_medium"
            class="w-full text-center p-3 rounded-lg border-2 border-gray-200 cursor-pointer transition-all duration-200 ease-in-out peer-checked:border-yellow-500 peer-checked:bg-yellow-50 peer-checked:font-bold peer-checked:text-yellow-800 hover:bg-cyan-100"
          >
            Medel
          </label>
        </div>

        <!-- Alternativ för "Hög" prioritet -->
        <div>
          <input
            type="radio"
            id="priority_high"
            name="priority"
            value="high"
            class="hidden peer"
          />
          <label
            for="priority_high"
            class="w-full text-center p-3 rounded-lg border-2 border-gray-200 cursor-pointer transition-all duration-200 ease-in-out peer-checked:border-red-500 peer-checked:bg-red-50 peer-checked:font-bold peer-checked:text-red-800 hover:bg-cyan-100"
          >
            Hög
          </label>
        </div>
      </div>
    </div>

    <!-- Ansvariga och Deadline -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label
          for="assignees"
          class="block text-sm font-medium text-gray-700 mb-1"
          >Ansvarig (en eller flera)</label
        >
        <select
          id="assignees"
          name="assignees"
          multiple
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring focus:ring-teal-500 focus:ring-opacity-50 h-32 transition duration-150 ease-in-out"
        >
          {
            assignees.map((person) => (
              <option value={person.id} class="p-2 hover:bg-cyan-100">
                {person.name}
              </option>
            ))
          }
        </select>
      </div>

      <div>
        <label
          for="due_date"
          class="block text-sm font-medium text-gray-700 mb-1">Deadline</label
        >
        <input
          type="date"
          name="due_date"
          id="due_date"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring focus:ring-teal-500 focus:ring-opacity-50 transition duration-150 ease-in-out"
        />
      </div>
    </div>

    <!-- Submit-knapp -->
    <div>
      <button
        type="submit"
        class="w-full flex justify-center py-3 px-4 rounded-lg border-2 cursor-pointer transition-all duration-200 ease-in-out hover:border-teal-500 hover:bg-cyan-100 font-bold hover:text-sky-800 text-cyan-900 bg-stone-100 border-cyan-300 hover:scale-105"
      >
        Spara uppgift
      </button>
    </div>
  </form>
</div>

<script>
  const form = document.getElementById("task-form");


  if (form instanceof HTMLFormElement) {
    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      const formData = new FormData(form);
      const dataFromForm = Object.fromEntries(formData.entries());


      const taskData = {
        ...dataFromForm,
        assignees: formData.getAll("assignees"),
        due_date: dataFromForm.due_date || null,
      };

      console.log("Uppgiftsdata som ska skickas till Supabase:", taskData);

      // ---- HÄR ANSLUTER DU TILL SUPABASE ----
      // import { supabase } from '/src/lib/supabaseClient.js';
      // const { data, error } = await supabase.from('tasks').insert([taskData]).select();
      //
      // if (error) {
      //   console.error('Fel:', error);
      // } else {
      //   console.log('Sparat:', data);
      //   form.reset();
      // }
      // -----------------------------------------

      alert("Formuläret har skickats! Kolla konsolen (F12) för att se datan.");
    });
  }
</script>
